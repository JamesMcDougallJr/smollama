{% extends "base.html" %}

{% block title %}Memories{% endblock %}

{% block content %}
<div class="space-y-8">
    <!-- Header -->
    <div>
        <h1 class="text-3xl font-bold text-white">Memories</h1>
        <p class="mt-2 text-gray-400">Persistent facts and learned information</p>
    </div>

    <!-- Search -->
    <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
        <input type="text"
               id="search-input"
               name="query"
               value="{{ query }}"
               placeholder="Search memories..."
               hx-get="/api/memories"
               hx-trigger="keyup changed delay:300ms"
               hx-target="#memories-list"
               hx-include="this"
               hx-swap="innerHTML"
               hx-push-url="true"
               class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
    </div>

    <script>
        // Sync search input with URL query parameter
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('search-input');

            // Update URL when input changes
            searchInput.addEventListener('input', function() {
                const query = searchInput.value.trim();
                const url = new URL(window.location);

                if (query) {
                    url.searchParams.set('query', query);
                } else {
                    url.searchParams.delete('query');
                }

                window.history.pushState({}, '', url);
            });
        });
    </script>

    <!-- Memories List -->
    <div id="memories-list" class="space-y-4">
        {% if memories %}
            {% for mem in memories %}
            <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 hover:border-purple-500 transition-colors">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <p class="text-white text-lg">{{ mem.text }}</p>
                        <div class="mt-3 flex items-center space-x-4 text-sm text-gray-400">
                            <span>Created: {{ mem.created_at }}</span>
                            {% if mem.times_confirmed > 1 %}
                            <span class="px-2 py-0.5 rounded bg-purple-900 text-purple-200">
                                Confirmed {{ mem.times_confirmed }}x
                            </span>
                            {% endif %}
                            <span>Confidence: {{ (mem.confidence * 100)|int }}%</span>
                        </div>
                    </div>
                    {% if mem.similarity %}
                    <div class="ml-4">
                        <div class="w-12 h-12 rounded-full bg-gray-700 flex items-center justify-center">
                            <span class="text-sm font-medium text-purple-400">{{ (mem.similarity * 100)|int }}%</span>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="text-center text-gray-500 py-8">
                <p>No memories stored yet</p>
                <p class="mt-2 text-sm">Memories are created when the agent learns persistent facts</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
